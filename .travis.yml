language: python
matrix:
  include:
  - os: linux
    sudo: false
    python: 3.5
    env:
      global:
      - TOXENV=py35
      - PYTHON=3
  - os: linux
    sudo: false
    python: 3.6
    env:
      global:
      - TOXENV=py36
      - PYTHON=3
  - os: linux
    sudo: false
    python: 2.7
    env:
      global:
      - TOXENV=py27
      - PYTHON=2
  - os: osx
    osx_image: xcode9.4
    language: generic
    env:
      global:
      - TOXENV=py36
      - PYTHON=3
  - os: osx
    osx_image: xcode9.4
    language: generic
    env:
      global:
      - TOXENV=py27
      - PYTHON=2
cache:
- pip
before_install:
- |
  if [ "$TRAVIS_OS_NAME" = "osx" ]; then
    brew update
    brew install hdf5 netcdf

    if [ "$PYTHON" = "2" ]; then
      brew install python@2
      export PATH="/usr/local/opt/python@2/libexec/bin:$PATH"

    elif [ "$PYTHON" = "37" ]; then
      brew upgrade python

    elif [ "$PYTHON" = "35" ]; then
      pyenv install 3.5.2
      pyenv local 3.5.2
      PATH="~/.pyenv/versions/3.5.2/bin:${PATH}"
      pip3 install --upgrade pip
      pip3 install numpy
      pip3 install matplotlib
      pip3 install scipy
      pip3 install future
      pip3 install configparser
      pip3 install netcdf4
    fi
  fi
install:
- |
  if [ "$PYTHON" = "2" ]; then
      python --version
      pip install --upgrade pip
      pip install 'matplotlib==1.4'
      python setup.py install

  elif ["$PYTHON" = "35"]; then
      python3 --version
      python3 setup.py install

  else
      python3 --version
      python3 setup.py install
  fi
script:
- |
  if [ "$PYTHON" = "2" ]; then
      python BCO/_tests/runAll.py

  elif ["$PYTHON" = "35"]; then
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      touch ~/.matplotlib/matplotlibrc
      echo backend: TkAgg > ~/.matplotlib/matplotlibrc
    fi

      python3 BCO/_tests/runAll.py
  else
      python3 BCO/_tests/runAll.py
  fi
deploy:
  provider: pypi
  user: tmachnitzki
  password:
    secure: L5nuW3np9ercQXGLSjV77QhEA6lYAgwLtp1cLUnuoJGIEJ6W62c1aObSLSbRa6nz1Lt2PPRYMiCavKVNXvMsvspk6t42P777hGawzVyyC84zCV2q+5U7O2YEpqqZDxrxTzK13FVcXbcipp9DHwJaFLiTwS7/0P5kNOssA3MKaj5Gf9+QpvSk36VZNFPvr9EeEIN4EgViYgkimK9ASTMCpKXJJkOfxTXcHv2CLQ0I97Sjh+yb7POThrQI7EhHJ4qJce4vu9NENoa9Aywm19FzuHtzPbyYqmA1C4kYweoYvLHMjXXWMse5SM/9dO6nq/bhCmp77YBIlfTrY+7uM40DqmYOY62VDayiUWIAoMmeOmn5NAKP197AhPFfiOcxTveP+p2LeRqHFCuMxfulKnP/GdUUw03HCkE1Nb4AxSrVzEff2sdSxuend5wN1rVtOndJxpIzbWYp+/6P6exLEpGfi94PJO+SAYNM/vjM2rNqzXkjSK/3u2H9Kd8GurmS9UZPKB76r/W/DpIwMcEU6YZBC91NNJ450WyKJtCHmoB2greetPjUQyr/6qjw4JyQHcFM2I04HCnPt/brylTdwklPvoqxOVFmMntoVwWKqVlOq7MZrJ6YjycjufZGchqPpiccpY6WSUk4bSV8yGELuIznBTrxPUQM+N43Ql1/fal1bP0=
  on:
    branch: master
    python: 2.7