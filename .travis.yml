language: python
matrix:
  include:
  - os: linux
    sudo: false
    python: 3.5
    env:
      global:
      - TOXENV=py35
      - PYTHON=3
  - os: linux
    sudo: false
    python: 3.6
    env:
      global:
      - TOXENV=py36
      - PYTHON=3
  - os: linux
    sudo: false
    python: 2.7
    env:
      global:
      - TOXENV=py27
      - PYTHON=2
  - os: osx
    osx_image: xcode9.4
    language: generic
    env:
      global:
      - TOXENV=py36
      - PYTHON=3
  - os: osx
    osx_image: xcode9.4
    language: generic
    env:
      global:
      - TOXENV=py27
      - PYTHON=2
before_install:
- |
  if [ "$TRAVIS_OS_NAME" = "osx" ]; then
    brew update
    brew install hdf5 netcdf

    if [ "$PYTHON" = "2" ]; then
      brew install python@2
      export PATH="/usr/local/opt/python@2/libexec/bin:$PATH"


    elif [ "$PYTHON" = "37" ]; then
      brew upgrade python


    elif [ "$PYTHON" = "35" ]; then
      pyenv install 3.5.2
      pyenv local 3.5.2
      PATH="~/.pyenv/versions/3.5.2/bin:${PATH}"
      pip3 install --upgrade pip
      pip3 install numpy
      pip3 install matplotlib
      pip3 install scipy
      pip3 install future
      pip3 install configparser
      pip3 install netcdf4
    fi
  fi
install:
- |
  if [ "$PYTHON" = "2" ]; then
      python --version
      pip install --upgrade pip
      pip install 'matplotlib==1.4'
      python setup.py install

  elif ["$PYTHON" = "35"]; then
      python3 --version
      python3 setup.py install

  else
      python3 --version
      python3 setup.py install
  fi
script:
- |
  if [ "$PYTHON" = "2" ]; then
      python BCO/_tests/runAll.py

  elif ["$PYTHON" = "35"]; then
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      touch ~/.matplotlib/matplotlibrc
      echo backend: TkAgg > ~/.matplotlib/matplotlibrc
    fi

      python3 BCO/_tests/runAll.py
  else
      python3 BCO/_tests/runAll.py
  fi
deploy:
  provider: pipy
  user: tmachnitzki
  password:
    secure: EyNTfhaUJ4tYU0+5m3caG17yjty3fQFvHuayIePMeDZqmcyuo3J/q8g7DRMOPskOaNiaXe//rZk1xEg7UCZJMFgcRGfBuXj8sNh1TyoqWHimNC4peI2G7SYY8fZ7Y1mi8drHtkg6zlrgJ98GYn3It/pmOHdKazOlayUaF+pVvuKQl7z9DXwpo1PoIt/Ti2J9CIOFuHVwtdXmmows4XFK7ZmiSq2gYz8z/ADJEtQFEuPuhKMqjN/RZfk9yXGhb5fAMkaG4YcmkABLUSxs4ZHbqLK0+bwhGdTnD3m3ugXyXF9JV5grev96fz/k1CRT0wu/1QmZxBDSjkW6GHdoYeyZKXrTwjRZlZfFLn1TkCiMNu8wFYtXzAKMFJvsd9RKyJqDaOQeOaX9c3NSyFXS1vPpDt5UinaNh0gDfh07eoscwFAqSCcPMe0TkxMCLPKo4taCMpT9CEyoaPSAWwxfRWZYlZ1qTOXXU65HQSNnM7Z4PKV+hyL7SFP7cAyo6HsUbKtEfePedlmHQeg6EUzhhL4zkC1AgbkWQDJkYoroxch01KePTyQsZEKcT5rRRlsMLqEQG9IceVgNHMXuf0CwMJ23pG13V98SAfFB8/EayakgeSfvjFZoec9CcNHRQ2/GnlG9sq6Y0WxrHIe/gQx+lTw5ib23eDhCFk3rWSVY9K1U3HE=
  server: https://test.pypi.org